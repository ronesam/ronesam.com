<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="chrome=1"/><title>PostgreSQL: 全栈开发之旅</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/><meta name="author" content="ronesam"/><meta name="description" content="当mysql不再免费, 你需要更好的数据库.">
<meta property="og:type" content="article">
<meta property="og:title" content="PostgreSQL">
<meta property="og:url" content="https://ronesam.com/about/example/postgresql/index.html">
<meta property="og:site_name" content="全栈开发之旅">
<meta property="og:description" content="当mysql不再免费, 你需要更好的数据库.">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-10T03:59:29.979Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PostgreSQL">
<meta name="twitter:description" content="当mysql不再免费, 你需要更好的数据库."><link rel="icon" type="image/x-icon" href="/zero/img/favicon.ico"/><link rel="stylesheet" href="/vendor/bootstrap/3.3.5/css/bootstrap.min.css"><link rel="stylesheet" href="/vendor/font-awesome/4.4.0/css/font-awesome.min.css"><link rel="stylesheet" href="/vendor/remodal/1.0.5/remodal.min.css"><link rel="stylesheet" href="/vendor/remodal/1.0.5/remodal-default-theme.min.css"><link rel="stylesheet" href="/zero/css/style.css"><script src="/vendor/jquery/2.1.4/jquery.min.js"></script></head><body><div class="wrapper"><header id="header"><div class="title"><h1><a href="/">全栈开发之旅</a></h1><p class="fa fa-github-alt"><a href="/about/summary/" target="_blank">学以致用, 知行合一</a></p></div><nav class="nav"><ul><li><a href="/wind/summary/">交互层</a></li><li><a href="/fire/summary/">业务层</a></li><li><a href="/water/summary/">服务层</a></li><li><a href="/earth/summary/">事务层</a></li></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div class="content"><article class="post"><header><div class="icon"></div><a href="/about/example/postgresql/"><time datetime="2017-11-10T03:51:39.764Z">2017-11-10</time></a><h1 class="title">PostgreSQL</h1></header><div class="entry"><blockquote><p>当mysql不再免费, 你需要更好的数据库.</p>
</blockquote>
<a id="more"></a>
<h2 id="PostgreSQL：9-x"><a href="#PostgreSQL：9-x" class="headerlink" title="PostgreSQL：9.x"></a>PostgreSQL：<code>9.x</code></h2><p>放弃反抗吧，<code>MySQL</code> or <code>MariaDB</code>？No。有更好的选择：<code>PostgreSQL</code>：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># <span class="selector-tag">yum</span> <span class="selector-tag">list</span> <span class="selector-tag">postgresql</span></div><div class="line"></div><div class="line"><span class="selector-tag">postgresql</span><span class="selector-class">.x86_64</span>                                   8<span class="selector-class">.4</span><span class="selector-class">.20-6</span><span class="selector-class">.el6</span></div></pre></td></tr></table></figure></p>
<p>But，我们需要<code>9.x</code>。</p>
<p>访问：<a href="https://yum.postgresql.org/" target="_blank" rel="external">https://yum.postgresql.org/</a></p>
<p>找到你需要的版本，例如：</p>
<blockquote>
<p>[9.6 &gt; CentOS 6 - x86_64]<br><a href="https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-6-x86_64/pgdg-centos96-9.6-3.noarch.rpm" target="_blank" rel="external">https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-6-x86_64/pgdg-centos96-9.6-3.noarch.rpm</a></p>
</blockquote>
<h3 id="安装-PGDG-RPM-file"><a href="#安装-PGDG-RPM-file" class="headerlink" title="安装 PGDG RPM file"></a>安装 PGDG RPM file</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># yum install https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel<span class="string">-6</span>-x86_64/pgdg-centos96<span class="string">-9</span>.6<span class="string">-3</span>.noarch.rpm</div></pre></td></tr></table></figure>
<h3 id="安装-PostgreSQL"><a href="#安装-PostgreSQL" class="headerlink" title="安装 PostgreSQL"></a>安装 PostgreSQL</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum list postgresql*</span></div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"> yum install postgresql96-server</span></div></pre></td></tr></table></figure>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># service postgresql-9.6 initdb</span></div><div class="line"></div><div class="line"><span class="attribute">Initializing</span> database: <span class="meta"> [  OK  ]</span></div></pre></td></tr></table></figure>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># <span class="selector-tag">service</span> <span class="selector-tag">postgresql-9</span><span class="selector-class">.6</span> <span class="selector-tag">start</span></div><div class="line"></div><div class="line"><span class="selector-tag">Starting</span> <span class="selector-tag">postgresql-9</span><span class="selector-class">.6</span> <span class="selector-tag">service</span>:  <span class="selector-attr">[  OK  ]</span></div><div class="line"></div><div class="line"># <span class="selector-tag">lsof</span> <span class="selector-tag">-i</span><span class="selector-pseudo">:5432</span></div></pre></td></tr></table></figure>
<h3 id="配置用户"><a href="#配置用户" class="headerlink" title="配置用户"></a>配置用户</h3><ul>
<li>新建一个Linux新用户，可以取你想要的名字，这里为<code>xeon</code>：<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> adduser xeon</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>PS：如果不新建此用户，后面登录的时候会报错：</p>
<blockquote>
<p>psql: FATAL:  Peer authentication failed for user “xeon”</p>
</blockquote>
<p>原因是：</p>
<blockquote>
<p>Your connection failed because by default psql connects over UNIX sockets using peer authentication, that requires the current UNIX user to have the same user name as psql. So you will have to create the UNIX user dev and then login as dev or use sudo -u dev psql test_development for accessing the database (and psql should not ask for a password)</p>
</blockquote>
<ul>
<li>切换到<code>pgsql</code>的默认用户：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> su - postgres</span></div></pre></td></tr></table></figure>
<ul>
<li>登录到控制台：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> psql</span></div></pre></td></tr></table></figure>
<ul>
<li>设置默认用户<code>postgres</code>的密码：</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">postgres=<span class="meta">#  \password postgres</span></div><div class="line"></div><div class="line">Enter <span class="keyword">new</span> <span class="type">password</span>:</div></pre></td></tr></table></figure>
<ul>
<li>创建数据库用户<code>xeon</code>，并设置密码：</li>
</ul>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">postgres=#  <span class="keyword">CREATE</span> <span class="keyword">USER</span> xeon <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span> <span class="string">'password'</span>;</div></pre></td></tr></table></figure>
<ul>
<li>创建用户数据库，这里为<code>xeon_uml</code>，并指定所有者为<code>xeon</code>：</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">postgres=<span class="comment">#  CREATE DATABASE xeon_uml OWNER xeon;</span></div></pre></td></tr></table></figure>
<ul>
<li>将<code>xeon_uml</code>数据库的所有权限都赋予<code>xeon</code>，否则<code>xeon</code>只能登录控制台，没有任何数据库操作权限：</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">postgres</span>=# GRANT ALL PRIVILEGES <span class="literal">ON</span> DATABASE xeon_uml to xeon;</div></pre></td></tr></table></figure>
<ul>
<li>切换到新用户<code>xeon</code>：</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">postgres=<span class="comment"># &lt;ctrl + d&gt;</span></div><div class="line"></div><div class="line">$ &lt;ctrl + d&gt;</div><div class="line"></div><div class="line"><span class="comment"># su - xeon</span></div><div class="line"></div><div class="line">$ psql -d xeon_uml</div><div class="line"></div><div class="line">xeon_uml=&gt; \l</div></pre></td></tr></table></figure>
<p>到目前为止，数据库已经配置好了，但还只能在本机玩耍，我们需要配置支持远程访问，方便管理。</p>
<ul>
<li>远程访问</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># cd <span class="regexp">/var/</span>lib<span class="regexp">/pgsql/</span><span class="number">9.6</span><span class="regexp">/data/</span></div></pre></td></tr></table></figure>
<p>调整以下配置：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vim postgresql.conf</span></div><div class="line"></div><div class="line"><span class="bullet">-</span><span class="bullet">--</span> <span class="string">change</span> <span class="string">the</span> <span class="string">line</span> <span class="meta">---</span></div><div class="line"><span class="comment"># listen_addresses = 'localhost'         # what IP address(es) to listen on;</span></div><div class="line"><span class="bullet">-</span><span class="bullet">--</span> <span class="string">to</span> <span class="meta">---</span></div><div class="line"><span class="string">listen_addresses</span> <span class="string">=</span> <span class="string">'*'</span></div></pre></td></tr></table></figure></p>
<p>以及：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vim pg_hba.conf</span></div><div class="line"></div><div class="line"><span class="bullet">-</span><span class="bullet">--</span> <span class="string">add</span> <span class="string">a</span> <span class="string">new</span> <span class="string">line</span> <span class="meta">---</span></div><div class="line"><span class="string">host</span>    <span class="string">all</span>             <span class="string">all</span>             <span class="number">121.43</span><span class="number">.18</span><span class="number">.66</span><span class="string">/32</span>         <span class="string">md5</span></div></pre></td></tr></table></figure></p>
<p>PS1：<code>121.43.18.66</code>这个IP是阿里云管理控制台的IP，可能会有更换，不要紧，添加的时候它会提示你哪个IP没有权限的；</p>
<p>PS2：<code>/32</code>的含义</p>
<blockquote>
<p>32 -&gt; 192.168.1.1/32 表示必须是来自这个IP地址的访问才合法；<br>24 -&gt; 192.168.1.0/24 表示只要来自192.168.1.0 ~ 192.168.1.255的都合法；<br>16 -&gt; 192.168.0.0/16 表示只要来自192.168.0.0 ~ 192.168.255.255的都合法；<br>8   -&gt; 192.0.0.0/8 表示只要来自192.0.0.0 ~ 192.255.255.255的都合法；<br>0   -&gt; 0.0.0.0/0 表示全部IP地址都合法，/左边的IP地址随便了只要是合法的IP地址即可；</p>
</blockquote>
<p>PS3：阿里云管理控制台添加数据库的时候需要填写ECS的外网IP，而不能是内网的，这个坑了我半天时间。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://wiki.postgresql.org/wiki/YUM_Installation" target="_blank" rel="external">YUM Installation PostgreSQL</a></li>
<li><a href="http://blog.csdn.net/leolaurel/article/details/51967702" target="_blank" rel="external">阿里云ECS(CentOS)上安装PostgreSQL9.4 </a>(文内的版本下载地址是错误的，看看就好)</li>
<li><a href="http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html" target="_blank" rel="external">PostgreSQL 新手入门（阮一峰）</a></li>
<li><a href="http://blog.csdn.net/ll136078/article/details/12747403" target="_blank" rel="external">PostgreSQL 允许远程访问设置方法</a></li>
<li><a href="http://jingyan.baidu.com/article/ca41422f3a4a5f1eae99edba.html" target="_blank" rel="external">postgresql允许远程连接 linux版</a></li>
<li><a href="http://www.cnblogs.com/jevonsea/archive/2013/01/24/2874184.html" target="_blank" rel="external">Postgresql允许远程访问配置修改</a></li>
<li><a href="http://blog.csdn.net/pipi0714/article/details/46047483" target="_blank" rel="external">配置PostgreSQL远程访问</a></li>
</ul>
</div><footer><div class="shares fa fa-weixin"><a>分享到微信</a></div></footer><div class="clearfix"></div></article><aside><ul class="action">   <li title="回到顶部" class="icon-arrow-up"> </li><li title="索引" data-remodal-target="toc" class="icon-toc"></li><li title="评论" data-remodal-target="comment" class="icon-comment"></li><li title="全屏" class="icon-fullscreen"></li></ul><ul class="page"> <li class="icon-prev"></li><li title="目录" data-remodal-target="summary" class="icon-summary"></li><li class="icon-next"></li></ul></aside><div data-remodal-id="toc" data-remodal-options="hashTracking: false" class="remodal"><button data-remodal-action="close" class="remodal-close"></button><h3>索引</h3><article class="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#PostgreSQL：9-x"><span class="toc-number">1.</span> <span class="toc-text">PostgreSQL：9.x</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-PGDG-RPM-file"><span class="toc-number">1.1.</span> <span class="toc-text">安装 PGDG RPM file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-PostgreSQL"><span class="toc-number">1.2.</span> <span class="toc-text">安装 PostgreSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化"><span class="toc-number">1.3.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动"><span class="toc-number">1.4.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置用户"><span class="toc-number">1.5.</span> <span class="toc-text">配置用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">2.</span> <span class="toc-text">参考资料</span></a></li></ol></article></div><div data-remodal-id="summary" data-remodal-options="hashTracking: false" class="remodal"><button data-remodal-action="close" class="remodal-close"></button><h3>目录</h3><article class="summary"></article></div><div data-remodal-id="comment" data-remodal-options="hashTracking: false" class="remodal"><button data-remodal-action="close" class="remodal-close"></button><h3>评论</h3><article class="comment"><div data-thread-key="ronesam" data-title="PostgreSQL" data-url="/about/example/postgresql/" class="ds-thread"></div></article></div></div></div><footer id="footer"><div class="copyright">&copy; 2017 <a href="/">ronesam</a></div><div class="theme-copyright">Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>  | Redesign by <a href="https://ronesam.com/about/summary/" target="_blank">ronesam</a></div><div class="clearfix"></div></footer><script src="/vendor/remodal/1.0.5/remodal.min.js"></script><script src="/vendor/screenfull.js/2.0.0/screenfull.min.js"></script><!--需要先载入全屏的函数，aside里面会重写，加入回调--><script src="/zero/js/aside.js"></script><script>var duoshuoQuery = {short_name: 'ronesam'};</script></body></html>