{"summary":"<blockquote><p>不可错过的日志管理工具.</p>\n</blockquote>\n<a id=\"more\"></a>\n<h1 id=\"场景\"><a href=\"#场景\" class=\"headerlink\" title=\"场景\"></a>场景</h1><p>现有3台阿里云机器，系统版本为：CentOS 6.5、64位。</p>\n<ul>\n<li>web_47：admin</li>\n<li>web_46：web1</li>\n<li>web_140：web2</li>\n</ul>\n<p>其中<code>web_47</code>用于内部管理站点，外部用户不可访问；<code>web_46 &amp;&amp; web_140</code>同时对外提供web访问服务（Nginx负载均衡）。</p>\n<h1 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h1><p>需要把<code>web_47 &amp;&amp; web_46 &amp;&amp; web_140</code>上的系统日志：</p>\n<ul>\n<li>nginx-log</li>\n<li>php-fpm-log</li>\n<li>access-log</li>\n</ul>\n<p>以及<code>web_46 &amp;&amp; web_140</code>的用户访问日志：</p>\n<ul>\n<li>page-view-log</li>\n</ul>\n<p>统一转发到web_47，并通过pgv.xeon.ren来访问。</p>\n<h1 id=\"过程\"><a href=\"#过程\" class=\"headerlink\" title=\"过程\"></a>过程</h1><p>以下是使用ELK(Elasticsearch &amp;&amp; Logstash &amp;&amp; Kibana)来搭建实时日志分析系统的过程：</p>\n<h2 id=\"下载软件：\"><a href=\"#下载软件：\" class=\"headerlink\" title=\"下载软件：\"></a>下载软件：</h2><p>下载以下软件：</p>\n<ul>\n<li><a href=\"https://download.elastic.co/logstash/logstash/logstash-2.1.1.tar.gz\" target=\"_blank\" rel=\"external\">logstash-2.1.1</a></li>\n<li><a href=\"http://download.redis.io/releases/redis-2.8.4.tar.gz\" target=\"_blank\" rel=\"external\">redis-2.8.4</a></li>\n<li><a href=\"https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.1.0/elasticsearch-2.1.0.tar.gz\" target=\"_blank\" rel=\"external\">elasticsearch-2.1.0</a></li>\n<li><a href=\"https://download.elastic.co/kibana/kibana/kibana-4.3.1-linux-x64.tar.gz\" target=\"_blank\" rel=\"external\">kibana-4.3.1-linux-x64</a></li>\n</ul>\n<p>上传到<code>web_47</code>，并解压到：<code>tar -zxvf *.tar.gz -C /usr/local/logger/</code></p>\n<h2 id=\"启动Logstash\"><a href=\"#启动Logstash\" class=\"headerlink\" title=\"启动Logstash\"></a>启动Logstash</h2><p><em>Logstash</em>，日志收集器，通过它把散落在所有机器的所有日志收集起来。</p>\n<p>这是个开箱即用的工具，并不需要安装，我们只需要配置好，并启用它即可。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/logger/logstash-2.1.1/bin/</span></div><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ./logstash -e <span class=\"string\">\"\"</span></span></div></pre></td></tr></table></figure>\n<p>这一步的操作有点慢，耐心等待，直到提示出现：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">……</div><div class=\"line\">Logstash startup completed</div></pre></td></tr></table></figure>\n<p>随便输入点什么，比如<code>Hello World!</code>：</p>\n<figure class=\"highlight coq\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">Hello World!</div><div class=\"line\">&#123;</div><div class=\"line\">       <span class=\"string\">\"message\"</span> =&gt; <span class=\"string\">\"Hello World!\"</span>,</div><div class=\"line\">      <span class=\"string\">\"@version\"</span> =&gt; <span class=\"string\">\"1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"@timestamp\"</span> =&gt; <span class=\"string\">\"2016-09-22T11:51:23.866Z\"</span>,</div><div class=\"line\">          <span class=\"string\">\"type\"</span> =&gt; <span class=\"string\">\"stdin\"</span>,</div><div class=\"line\">          <span class=\"string\">\"host\"</span> =&gt; <span class=\"string\">\"tugou07\"</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>很好，测试成功了。</p>\n<p>当然，这个并无实际意义，现在我们开始配置并收集PHP的错误日志：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/logger/logstash-2.1.1/</span></div><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mkdir conf</span></div><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">cd</span> conf</span></div><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> vim shipper.conf</span></div></pre></td></tr></table></figure>\n<p>Logstash收集并处理过的原日志会自动删除吗？</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ul>\n<li><a href=\"http://www.w2bc.com/article/104935\" target=\"_blank\" rel=\"external\">Logstash+Redis+Elasticsearch+Kibana+Nginx搭建日志分析系统</a></li>\n<li><a href=\"http://kibana.logstash.es/content/\" target=\"_blank\" rel=\"external\">ELKstack 中文指南</a></li>\n<li><a href=\"http://www.cnblogs.com/xing901022/p/4802822.html\" target=\"_blank\" rel=\"external\">Logstash使用详解</a></li>\n<li><a href=\"http://www.jianshu.com/p/6575041b597d\" target=\"_blank\" rel=\"external\">Logstash实践: 分布式系统的日志监控</a></li>\n<li><a href=\"http://udn.yyuap.com/doc/logstash-best-practice-cn/index.html\" target=\"_blank\" rel=\"external\">Logstash 最佳实践</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzIwMDc3Njk4NA==&amp;mid=2247483686&amp;idx=1&amp;sn=46bc77ff361cdce5bba59812e88b514f&amp;scene=0&amp;key=f5c31ae61525f82e97f5ef95160be90b6b79f39dc7604274da473bc782b6522906246423ce09c9ba7435d5ff05633270&amp;ascene=0&amp;uin=MTQ3NzAyNzQwMg%3D%3D&amp;devicety\" target=\"_blank\" rel=\"external\">Elastic Stack V5详解</a></li>\n</ul>\n"}